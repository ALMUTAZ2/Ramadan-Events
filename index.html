<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فوازير رمضان 1446</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');
        
        * {
            font-family: 'Cairo', sans-serif;
        }

        .floating-moon {
            animation: floatMoon 3s ease-in-out infinite;
        }

        @keyframes floatMoon {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .star {
            position: absolute;
            color: #FCD34D;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .option-correct {
            background-color: rgba(34, 197, 94, 0.2) !important;
            border-color: rgb(34, 197, 94) !important;
        }

        .option-wrong {
            background-color: rgba(239, 68, 68, 0.2) !important;
            border-color: rgb(239, 68, 68) !important;
        }

        .option-disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        @keyframes scaleNumber {
            0% { transform: scale(1); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 0; }
        }

        .countdown-number {
            animation: scaleNumber 1s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .countdown-text {
            animation: fadeInUp 0.5s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-900 to-indigo-950 min-h-screen">
    <!-- شريط التاريخ -->
    <div class="bg-white/5 backdrop-blur-sm border-b border-white/10 p-3 text-white text-center">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <span id="day-name" class="text-blue-400"></span>
            </div>
            <div class="flex items-center gap-2">
                <span id="current-date" class="text-green-400"></span>
            </div>
        </div>
    </div>

    <!-- شاشة خارج وقت المسابقة -->
    <div id="out-of-time-screen" class="hidden min-h-screen text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-yellow-400/20 rounded-3xl p-8 text-center">
                <i data-lucide="clock" class="w-16 h-16 mx-auto text-yellow-400 mb-4"></i>
                <h2 class="text-2xl font-bold text-yellow-400 mb-4">المسابقة غير متاحة حالياً</h2>
                <p class="text-gray-300 mb-4">المسابقة متاحة يومياً من الساعة 7 مساءً حتى 8 مساءً</p>
                <div id="time-message" class="text-green-400 text-lg mb-8"></div>
                <a href="leaderboard.html" class="inline-block bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white px-8 py-3 rounded-xl">
                    عرض نتائج المتصدرين
                </a>
            </div>
        </div>
    </div>

    <!-- شاشة المشاركة السابقة -->
    <div id="already-participated-screen" class="hidden min-h-screen text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-red-400/20 rounded-3xl p-8 text-center">
                <i data-lucide="alert-circle" class="w-16 h-16 mx-auto text-red-400 mb-4"></i>
                <h2 class="text-2xl font-bold text-red-400 mb-4">لقد شاركت مسبقاً</h2>
                <p class="text-gray-300 mb-6">يمكنك المشاركة مرة واحدة فقط في اليوم</p>
                <a href="leaderboard.html" class="inline-block bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white px-8 py-3 rounded-xl">
                    عرض نتائج المتصدرين
                </a>
            </div>
        </div>
    </div>

    <!-- شاشة جاري التحميل -->
    <div id="loading-screen" class="hidden min-h-screen text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-blue-400/20 rounded-3xl p-8 text-center">
                <div class="animate-spin w-16 h-16 mx-auto border-4 border-blue-400 border-t-transparent rounded-full mb-4"></div>
                <h2 class="text-2xl font-bold text-blue-400 mb-4">جاري التحميل</h2>
                <p class="text-gray-300 mb-6">يرجى الانتظار...</p>
            </div>
        </div>
    </div>
    <!-- شاشة البداية -->
    <div id="start-screen" class="hidden min-h-[calc(100vh-64px)] text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-green-400/20 rounded-3xl p-8">
                <div class="text-center space-y-6">
                    <div class="relative h-32">
                        <div class="floating-moon">
                            <i data-lucide="moon" class="w-20 h-20 mx-auto text-yellow-400"></i>
                        </div>
                        <div class="absolute bottom-0 w-full">
                            <i data-lucide="star" class="star w-4 h-4" style="left: calc(50% - 20px);"></i>
                            <i data-lucide="star" class="star w-4 h-4" style="left: 50%;"></i>
                            <i data-lucide="star" class="star w-4 h-4" style="left: calc(50% + 20px);"></i>
                        </div>
                    </div>
                    <h1 class="text-3xl font-bold text-yellow-400">فوازير رمضان</h1>
                    <div class="space-y-4">
                        <label class="text-lg block text-center mb-2">
                            أدخل اسمك للمشاركة في المسابقة
                        </label>
                        <input
                            type="text"
                            id="player-name"
                            placeholder="الاسم الكريم"
                            class="w-full bg-white/5 border-2 border-green-400/20 text-center text-lg py-6 rounded-xl text-white"
                        >
                        <input
                            type="email"
                            id="player-email"
                            placeholder="البريد الإلكتروني (اختياري)"
                            class="w-full bg-white/5 border-2 border-green-400/20 text-center text-lg py-6 rounded-xl text-white"
                        >
                    </div>
                    <button
                        id="start-button"
                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-6 rounded-xl text-lg flex items-center justify-center gap-2"
                        disabled
                    >
                        <i data-lucide="sparkles" class="w-5 h-5"></i>
                        بدء المسابقة
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- شاشة المسابقة -->
    <div id="quiz-screen" class="hidden min-h-[calc(100vh-64px)] text-white flex items-center justify-center p-6">
        <div class="max-w-2xl w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-blue-400/20 rounded-3xl p-8">
                <div class="text-center space-y-6">
                    <div class="flex justify-between items-center">
                        <div class="text-sm text-blue-400">السؤال <span id="question-number">1</span> من <span id="total-questions">10</span></div>
                        <div id="timer" class="text-sm text-yellow-400"></div>
                    </div>
                    <div id="question-text" class="text-xl font-bold"></div>
                    <div id="options" class="space-y-4">
                        <!-- سيتم إضافة الخيارات ديناميكياً -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- شاشة النتيجة -->
    <div id="result-screen" class="hidden min-h-[calc(100vh-64px)] text-white flex items-center justify-center p-6">
        <div class="max-w-md w-full">
            <div class="bg-white/10 backdrop-blur-lg border-2 border-yellow-400/20 rounded-3xl p-8 text-center">
                <i data-lucide="trophy" class="w-16 h-16 mx-auto text-yellow-400 mb-4"></i>
                <h2 class="text-2xl font-bold text-yellow-400 mb-4">نتيجة المسابقة</h2>
                <p class="text-gray-300 mb-2">أحسنت! لقد أكملت المسابقة</p>
                <div class="text-3xl font-bold text-green-400 mb-8">
                    <span id="score">0</span> من <span id="total-score">0</span>
                </div>
                <a href="leaderboard.html" class="inline-block bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white px-8 py-3 rounded-xl">
                    عرض نتائج المتصدرين
                </a>
            </div>
        </div>
    </div>

<script>
    // تهيئة Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDYJMvGwxXLYrRWIlPBe-YlPSe5zLxwC5s",
        authDomain: "ramadan-quiz-2024.firebaseapp.com",
        projectId: "ramadan-quiz-2024",
        storageBucket: "ramadan-quiz-2024.appspot.com",
        messagingSenderId: "123456789012",
        appId: "1:123456789012:web:abc123def456ghi789"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // المتغيرات العامة
    const QUIZ_MODE = "always"; // "always", "never", "normal"
    const QUIZ_START_HOUR = 19;
    const QUIZ_END_HOUR = 20;
    const QUESTION_TIME = 20;

    let currentQuestionIndex = 0;
    let score = 0;
    let questions = [
        {
            text: "ما هو أول شهر في التقويم الهجري؟",
            options: ["محرم", "رمضان", "شوال", "ربيع الأول"],
            correctIndex: 0
        },
        {
            text: "كم عدد ركعات صلاة التراويح؟",
            options: ["8 ركعات", "20 ركعة", "12 ركعة", "6 ركعات"],
            correctIndex: 1
        },
        {
            text: "في أي ليلة من رمضان تُلتمس ليلة القدر؟",
            options: ["العشر الأوائل", "العشر الأواخر", "منتصف الشهر", "أول ليلة"],
            correctIndex: 1
        },
        {
            text: "ما هو أول مسجد بُني في الإسلام؟",
            options: ["المسجد الحرام", "المسجد النبوي", "مسجد قباء", "المسجد الأقصى"],
            correctIndex: 2
        },
        {
            text: "كم عدد أيام شهر رمضان؟",
            options: ["28 يوم", "29 أو 30 يوم", "31 يوم", "30 يوم فقط"],
            correctIndex: 1
        }
    ];
    let timer = null;
    let timeLeft = QUESTION_TIME;

    // دالة للحصول على توقيت المغرب
    function getMoroccoTime() {
        return new Date();
    }

    function updateDateTime() {
        const days = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
        const now = getMoroccoTime();
        const dayName = days[now.getDay()];
        const date = now.toLocaleDateString('ar-MA');
        
        document.getElementById('day-name').textContent = dayName;
        document.getElementById('current-date').textContent = date;
    }

    function checkQuizTimeStatus() {
        return {
            isAvailable: true,
            message: "المسابقة متاحة الآن!",
            status: "available"
        };
    }

    function getTodayFormatted() {
        const now = getMoroccoTime();
        return now.toISOString().split('T')[0];
    }

    function showScreen(screenId) {
        const screens = ['loading-screen', 'start-screen', 'quiz-screen', 'result-screen', 'out-of-time-screen', 'already-participated-screen'];
        screens.forEach(screen => {
            document.getElementById(screen).classList.add('hidden');
        });
        document.getElementById(screenId).classList.remove('hidden');
    }

    function updateTimer() {
        const timerElement = document.getElementById('timer');
        timerElement.textContent = `${timeLeft} ثانية`;
        
        if (timeLeft <= 0) {
            clearInterval(timer);
            handleNextQuestion();
        }
        timeLeft--;
    }

    function displayQuestion(question) {
        document.getElementById('question-number').textContent = currentQuestionIndex + 1;
        document.getElementById('total-questions').textContent = questions.length;
        document.getElementById('question-text').textContent = question.text;
        
        const optionsContainer = document.getElementById('options');
        optionsContainer.innerHTML = '';
        
        question.options.forEach((option, index) => {
            const button = document.createElement('button');
            button.className = 'w-full bg-white/5 border-2 border-blue-400/20 hover:bg-white/10 py-4 px-6 rounded-xl transition-all';
            button.textContent = option;
            button.onclick = () => handleAnswer(index === question.correctIndex);
            optionsContainer.appendChild(button);
        });

        timeLeft = QUESTION_TIME;
        if (timer) clearInterval(timer);
        timer = setInterval(updateTimer, 1000);
        updateTimer();
    }

    function handleAnswer(isCorrect) {
        clearInterval(timer);
        
        const options = document.querySelectorAll('#options button');
        options.forEach(option => option.classList.add('option-disabled'));
        
        const correctOption = options[questions[currentQuestionIndex].correctIndex];
        correctOption.classList.add('option-correct');
        
        if (isCorrect) {
            score++;
        } else {
            const selectedOption = Array.from(options).find(opt => opt === event.target);
            if (selectedOption) {
                selectedOption.classList.add('option-wrong');
            }
        }

        setTimeout(handleNextQuestion, 1500);
    }

    function handleNextQuestion() {
        currentQuestionIndex++;
        
        if (currentQuestionIndex < questions.length) {
            displayQuestion(questions[currentQuestionIndex]);
        } else {
            showResults();
        }
    }

    function showResults() {
        document.getElementById('score').textContent = score;
        document.getElementById('total-score').textContent = questions.length;
        showScreen('result-screen');
        
        const playerName = document.getElementById('player-name').value;
        const playerEmail = document.getElementById('player-email').value;
        
        localStorage.setItem('participationDate', getTodayFormatted());
        localStorage.setItem('hasParticipated', 'true');
        localStorage.setItem('participationInfo', JSON.stringify({
            name: playerName,
            score: score,
            total: questions.length,
            date: getTodayFormatted()
        }));

        // حفظ النتيجة في Firebase
        db.collection('scores').add({
            name: playerName,
            email: playerEmail,
            score: score,
            total: questions.length,
            date: getTodayFormatted(),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).catch(error => console.error("Error saving score:", error));
    }

    function startQuiz() {
        showScreen('quiz-screen');
        currentQuestionIndex = 0;
        score = 0;
        displayQuestion(questions[0]);
    }

    // تهيئة الصفحة
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
        updateDateTime();
        setInterval(updateDateTime, 60000);

        const playerNameInput = document.getElementById('player-name');
        const startButton = document.getElementById('start-button');
        
        playerNameInput.addEventListener('input', () => {
            startButton.disabled = !playerNameInput.value.trim();
        });

        startButton.addEventListener('click', startQuiz);

        showScreen('start-screen');
    });
</script>
</body>
</html>
